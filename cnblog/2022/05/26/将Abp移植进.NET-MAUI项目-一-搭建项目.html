<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>将Abp移植进.NET MAUI项目（一）：搭建项目 | dotnet之美</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="将Abp移植进.NET MAUI项目（一）：搭建项目" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="​ 前言 写在.NET MAUI官宣正式发布之际，热烈庆祝MAUI正式发布！ 去年12月份做了MAUI混合开发框架的调研，想起来文章里给自己挖了个坑，要教大家如何把Abp移植进Maui项目，由于篇幅限制，将分为三个章节。 将Abp移植进.NET MAUI项目（一）：搭建项目 - 林晓lx - 博客园 (cnblogs.com) 将Abp移植进.NET MAUI项目（二）：配置与基类编写 - 林晓lx - 博客园 (cnblogs.com) 将Abp移植进.NET MAUI项目（三）：构建UI层 - 林晓lx - 博客园 (cnblogs.com) 熟悉Abp的同学都知道，Abp 是一套强大的应用程序设计时框架（俗称脚手架），新版本的Abp vNext为微服务和网络优化的更多，然而本地开发经典Abp已经够用，而且官方没有停止维护，因此使用这个框架 MAUI则是跨平台的应用程序抽象层，强大的运行时框架 + 强大的设计时框架 ， 我说这是宇宙最强大跨平台开发框架，不为过吧？😁 计划： 整个程序我们还是利用Mvvm设计模式，但是将利用Abp的Ioc容器，而不使用mvvmlight或者xamarinToolkit这些库，自行编写一个ViewModelBase 使用Abp.EntityFrameworkCore库中的EF相关功能，使用sqlite作为数据持久化方案。" />
<meta property="og:description" content="​ 前言 写在.NET MAUI官宣正式发布之际，热烈庆祝MAUI正式发布！ 去年12月份做了MAUI混合开发框架的调研，想起来文章里给自己挖了个坑，要教大家如何把Abp移植进Maui项目，由于篇幅限制，将分为三个章节。 将Abp移植进.NET MAUI项目（一）：搭建项目 - 林晓lx - 博客园 (cnblogs.com) 将Abp移植进.NET MAUI项目（二）：配置与基类编写 - 林晓lx - 博客园 (cnblogs.com) 将Abp移植进.NET MAUI项目（三）：构建UI层 - 林晓lx - 博客园 (cnblogs.com) 熟悉Abp的同学都知道，Abp 是一套强大的应用程序设计时框架（俗称脚手架），新版本的Abp vNext为微服务和网络优化的更多，然而本地开发经典Abp已经够用，而且官方没有停止维护，因此使用这个框架 MAUI则是跨平台的应用程序抽象层，强大的运行时框架 + 强大的设计时框架 ， 我说这是宇宙最强大跨平台开发框架，不为过吧？😁 计划： 整个程序我们还是利用Mvvm设计模式，但是将利用Abp的Ioc容器，而不使用mvvmlight或者xamarinToolkit这些库，自行编写一个ViewModelBase 使用Abp.EntityFrameworkCore库中的EF相关功能，使用sqlite作为数据持久化方案。" />
<link rel="canonical" href="/cnblog/2022/05/26/%E5%B0%86Abp%E7%A7%BB%E6%A4%8D%E8%BF%9B.NET-MAUI%E9%A1%B9%E7%9B%AE-%E4%B8%80-%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE.html" />
<meta property="og:url" content="/cnblog/2022/05/26/%E5%B0%86Abp%E7%A7%BB%E6%A4%8D%E8%BF%9B.NET-MAUI%E9%A1%B9%E7%9B%AE-%E4%B8%80-%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE.html" />
<meta property="og:site_name" content="dotnet之美" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-26T12:47:33+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="将Abp移植进.NET MAUI项目（一）：搭建项目" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-26T12:47:33+00:00","datePublished":"2022-05-26T12:47:33+00:00","description":"​ 前言 写在.NET MAUI官宣正式发布之际，热烈庆祝MAUI正式发布！ 去年12月份做了MAUI混合开发框架的调研，想起来文章里给自己挖了个坑，要教大家如何把Abp移植进Maui项目，由于篇幅限制，将分为三个章节。 将Abp移植进.NET MAUI项目（一）：搭建项目 - 林晓lx - 博客园 (cnblogs.com) 将Abp移植进.NET MAUI项目（二）：配置与基类编写 - 林晓lx - 博客园 (cnblogs.com) 将Abp移植进.NET MAUI项目（三）：构建UI层 - 林晓lx - 博客园 (cnblogs.com) 熟悉Abp的同学都知道，Abp 是一套强大的应用程序设计时框架（俗称脚手架），新版本的Abp vNext为微服务和网络优化的更多，然而本地开发经典Abp已经够用，而且官方没有停止维护，因此使用这个框架 MAUI则是跨平台的应用程序抽象层，强大的运行时框架 + 强大的设计时框架 ， 我说这是宇宙最强大跨平台开发框架，不为过吧？😁 计划： 整个程序我们还是利用Mvvm设计模式，但是将利用Abp的Ioc容器，而不使用mvvmlight或者xamarinToolkit这些库，自行编写一个ViewModelBase 使用Abp.EntityFrameworkCore库中的EF相关功能，使用sqlite作为数据持久化方案。","headline":"将Abp移植进.NET MAUI项目（一）：搭建项目","mainEntityOfPage":{"@type":"WebPage","@id":"/cnblog/2022/05/26/%E5%B0%86Abp%E7%A7%BB%E6%A4%8D%E8%BF%9B.NET-MAUI%E9%A1%B9%E7%9B%AE-%E4%B8%80-%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE.html"},"url":"/cnblog/2022/05/26/%E5%B0%86Abp%E7%A7%BB%E6%A4%8D%E8%BF%9B.NET-MAUI%E9%A1%B9%E7%9B%AE-%E4%B8%80-%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="dotnet之美" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">dotnet之美</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">将Abp移植进.NET MAUI项目（一）：搭建项目</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-05-26T12:47:33+00:00" itemprop="datePublished">May 26, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>​</p>
<h2 id="前言">前言</h2>

<p>写在.NET MAUI官宣正式发布之际，<strong>热烈庆祝MAUI正式发布！</strong></p>

<p>去年12月份做了MAUI混合开发框架的调研，想起来文章里给自己挖了个坑，要教大家如何把Abp移植进Maui项目，由于篇幅限制，将分为三个章节。</p>

<p><a href="https://www.cnblogs.com/jevonsflash/p/16310387.html">将Abp移植进.NET MAUI项目（一）：搭建项目 - 林晓lx - 博客园 (cnblogs.com)</a></p>

<p><a href="https://www.cnblogs.com/jevonsflash/p/16310391.html">将Abp移植进.NET MAUI项目（二）：配置与基类编写 - 林晓lx - 博客园 (cnblogs.com)</a></p>

<p><a href="https://www.cnblogs.com/jevonsflash/p/16310399.html">将Abp移植进.NET MAUI项目（三）：构建UI层 - 林晓lx - 博客园 (cnblogs.com)</a></p>

<p>熟悉Abp的同学都知道，Abp 是一套强大的应用程序设计时框架（俗称脚手架），新版本的Abp vNext为微服务和网络优化的更多，然而本地开发经典Abp已经够用，而且官方没有停止维护，因此使用这个框架</p>

<p>MAUI则是跨平台的应用程序抽象层，强大的运行时框架 + 强大的设计时框架 ， 我说这是宇宙最强大跨平台开发框架，不为过吧？😁</p>

<p>计划：</p>

<ul>
  <li>整个程序我们还是利用Mvvm设计模式，但是将利用Abp的Ioc容器，而不使用mvvmlight或者xamarinToolkit这些库，自行编写一个ViewModelBase</li>
  <li>使用Abp.EntityFrameworkCore库中的EF相关功能，使用sqlite作为数据持久化方案。</li>
</ul>

<p>目标：编写一个歌单App，对歌曲信息进行增、删、查、改。</p>

<p>下面来看看如何搭建</p>

<h2 id="搭建maui项目">搭建MAUI项目</h2>

<p>请注意：本文发布时，MAUI处于RC3版本，仍没有正式发布，需要安装Visual Studio 2022 17.3 (Preview)</p>

<table>
  <tbody>
    <tr>
      <td>首先按照官方教程搭建一个MAUI项目， 命名为MauiBoilerplate[Build your first .NET MAUI app - .NET MAUI</td>
      <td>Microsoft Docs](https://docs.microsoft.com/en-us/dotnet/maui/get-started/first-app “Build your first .NET MAUI app - .NET MAUI</td>
      <td>Microsoft Docs”)</td>
    </tr>
  </tbody>
</table>

<p>再前往Abp官网生成一个项目 <br />
 <a href="https://aspnetboilerplate.com/Templates" title="Startup Templates - Create a Demo | AspNet Boilerplate">Startup Templates - Create a Demo | AspNet Boilerplate</a></p>

<ul>
  <li>选择最新版本 v7.x 和.Net 6版本</li>
  <li>取消勾选“Include login, register, user, role and tenant management pages”</li>
  <li>项目名称中填入MauiBoilerplate与Maui项目保持一致</li>
</ul>

<p><img src="https://img-blog.csdnimg.cn/b3370549e7ea4bd3b1869536b1b45490.png" alt="" /><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" />​</p>

<p>点击“Create My Project”生成abp项目文件，等待下载完成</p>

<p>下载，解压好后，打开src目录可以发现4个项目目录，我们仅需要Core和EntityFrameworkCore项目，将这两个目录移至项目根目录，并且添加至解决方案。</p>

<p><img src="https://img-blog.csdnimg.cn/4fe495b14ccb4e3ea95084a7ed900a26.png" alt="" /><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" />​</p>

<h2 id="配置应用入口点">配置应用入口点</h2>

<p>在MauiBoilerplate.Core项目中</p>

<p>改写默认配置文件</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "ConnectionStrings": {
    "Default": "Data Source=file:{0};"
  },
  "Logging": {
    "IncludeScopes": false,
    "LogLevel": {
      "Default": "Debug",
      "System": "Information",
      "Microsoft": "Information"
    }
  }
}
</code></pre></div></div>

<p><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" /></p>

<p>在MauiBoilerplate.Core.csproj中的ItemGroup节点下添加</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	  &lt;EmbeddedResource Include="appsettings.json"&gt;    &lt;CopyToOutputDirectory&gt;Always&lt;/CopyToOutputDirectory&gt;  &lt;/EmbeddedResource&gt;
</code></pre></div></div>

<p><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" /></p>

<p>在MauiBoilerplate.Core项目中新建MauiBoilerplateBuilderExtensions.cs 作为程序入口</p>

<p>添加一个静态方法InitConfig，用于读取项目的配置文件appsettings.json，若第一次运行或者该文件不存在则读取默认的配置文件</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        private static void InitConfig(string logCfgName, string documentsPath)
        {

            var assembly = IntrospectionExtensions.GetTypeInfo(typeof(MauiBoilerplateBuilderExtensions)).Assembly;

            Stream stream = assembly.GetManifestResourceStream($"MauiBoilerplate.Core.{logCfgName}");
            string text = "";
            using (var reader = new System.IO.StreamReader(stream))
            {
                text = reader.ReadToEnd();
            }
            if (DirFileHelper.IsExistFile(documentsPath))
            {
                var currentFileContent = DirFileHelper.ReadFile(documentsPath);
                var isSameContent = currentFileContent.ToMd5() == text.ToMd5();
                if (isSameContent)
                {
                    return;
                }
                DirFileHelper.CreateFile(documentsPath, text);

            }
            else
            {
                DirFileHelper.CreateFile(documentsPath, text);

            }
        }
</code></pre></div></div>

<p><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" /></p>

<p>添加一个静态方法InitDataBase用于初始化sqlite数据库文件”mato.db”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    private static void InitDataBase(string dbName, string documentsPath)
    {
            var assembly = IntrospectionExtensions.GetTypeInfo(typeof(MauiBoilerplateBuilderExtensions)).Assembly;
            Stream stream = assembly.GetManifestResourceStream($"MauiBoilerplate.Core.{dbName}");
            StreamHelper.WriteStream(stream, documentsPath);

            var path = Path.GetDirectoryName(documentsPath);
            DirFileHelper.CreateDir(path);
    }
</code></pre></div></div>

<p><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" /></p>

<p>添加一个 静态方法UseMauiBoilerplate用于初始化配置文件，初始化db文件和向管道服务中注册AbpBootstrapper实例。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        public static MauiAppBuilder UseMauiBoilerplate&lt;TStartupModule&gt;(this MauiAppBuilder builder) where TStartupModule : AbpModule
        {
            var logCfgName = "log4net.config";
            var appCfgName = "appsettings.json";
            var dbName = "mato.db";

            string documentsPath = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData), MauiBoilerplateConsts.LocalizationSourceName, logCfgName);
            string documentsPath2 = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData), MauiBoilerplateConsts.LocalizationSourceName, appCfgName);
            string dbPath = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData), MauiBoilerplateConsts.LocalizationSourceName, dbName);

            InitConfig(logCfgName, documentsPath);
            InitConfig(appCfgName, documentsPath2);
            InitDataBase(dbName, dbPath);
            var _bootstrapper = AbpBootstrapper.Create&lt;TStartupModule&gt;(options =&gt;
            {
                options.IocManager = new IocManager();
            });
            _bootstrapper.IocManager.IocContainer.AddFacility&lt;LoggingFacility&gt;(f =&gt; f.UseAbpLog4Net().WithConfig(documentsPath));

            builder.Services.AddSingleton(_bootstrapper);
            WindsorRegistrationHelper.CreateServiceProvider(_bootstrapper.IocManager.IocContainer, builder.Services);

            return builder;
        }
</code></pre></div></div>

<p><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" /></p>

<p>在MauiBoilerplate项目中</p>

<p>新建MauiBoilerplateModule.cs ，并编写代码如下，这是App起始模块</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[DependsOn(typeof(MauiBoilerplateEntityFrameworkCoreModule))]
    public class MauiBoilerplateModule : AbpModule
    {
        public override void Initialize()
        {
            IocManager.RegisterAssemblyByConvention(typeof(MauiBoilerplateModule).GetAssembly());
        }

    }
</code></pre></div></div>

<p><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" /></p>

<p>打开MauiProgram.cs文件，将UseMauiBoilerplate添加到MauiAppBuilder</p>

<p>这里提一下, MAUI 应用跟其他.Net6应用一样采用泛型主机启动应用，在项目中有一个静态<code class="language-plaintext highlighter-rouge">MauiProgram</code>类，这是应用的入口点。 这提供了从单个位置配置应用、服务和第三方库的功能。</p>

<table>
  <tbody>
    <tr>
      <td>更多泛型主机的信息，请参阅微软文档[.NET 通用主机</td>
      <td>Microsoft Docs](https://docs.microsoft.com/zh-CN/dotnet/core/extensions/generic-host “.NET 通用主机</td>
      <td>Microsoft Docs”)</td>
    </tr>
  </tbody>
</table>

<p><img src="https://img-blog.csdnimg.cn/44c5e71f7aee4139b7b610296f05eb8e.png" alt="" /><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" />​</p>

<p>至此，在主机管道中已经配置了MauiBoilerplate服务</p>

<h2 id="配置abp">配置Abp</h2>

<p>App.xaml是应用的声明起始点，将从这里初始化Abp</p>

<p>打开App.xaml.cs，添加如下代码：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public partial class App : Application
    {
        private readonly AbpBootstrapper _abpBootstrapper;

        public App(AbpBootstrapper abpBootstrapper)
        {
            _abpBootstrapper = abpBootstrapper;
            InitializeComponent();
            _abpBootstrapper.Initialize();
            this.MainPage = abpBootstrapper.IocManager.Resolve(typeof(MainPage)) as MainPage;
        }
    }
</code></pre></div></div>

<p><img src="https://img2022.cnblogs.com/blog/644861/202205/644861-20220525184242097-1492628253.gif" alt="" title="点击并拖拽以移动" /></p>

<p>注意，我们还没有创建初始页面MainPage，你可以先创建这个文件，将在第三章讲UI层时介绍</p>

<p>至此，就完成了MAUI项目的搭建与Abp脚手架的集成，现在你可以在这个项目中使用Abp的IocManager，ConfigurationManager，工作单元特性，模组化特性，等等任何的Abp提供的功能了。</p>

<p>但是距离目标：制作一个具有数据访问层的App，还需要两段路要走：配置数据库，以及编写界面。</p>

<p>请看下一章<a href="https://www.cnblogs.com/jevonsflash/p/16310391.html">将Abp移植进.NET MAUI项目（二）：配置与基类编写 - 林晓lx - 博客园 (cnblogs.com)</a></p>

<h2 id="项目地址"> 项目地址</h2>

<p><a href="https://github.com/jevonsflash/maui-abp-sample" title="jevonsflash/maui-abp-sample (github.com)">jevonsflash/maui-abp-sample (github.com)</a></p>

<p>​</p>
<blockquote>
  <p>作者:林晓lx
原文:https://www.cnblogs.com/jevonsflash/p/16310387.html</p>
</blockquote>

  </div><a class="u-url" href="/cnblog/2022/05/26/%E5%B0%86Abp%E7%A7%BB%E6%A4%8D%E8%BF%9B.NET-MAUI%E9%A1%B9%E7%9B%AE-%E4%B8%80-%E6%90%AD%E5%BB%BA%E9%A1%B9%E7%9B%AE.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">dotnet之美</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">dotnet之美</li><li><a class="u-email" href="mailto:springhgui@outlook.com">springhgui@outlook.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>分享dotnet技术.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
