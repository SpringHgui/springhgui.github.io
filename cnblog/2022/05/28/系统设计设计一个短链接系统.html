<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>【系统设计】设计一个短链接系统 | dotnet之美</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="【系统设计】设计一个短链接系统" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="短链接系统可以把比较长的 URL 网址转换成简短的网址字符串，短链接的优势是方便传播。适合在一些对字符串长度有要求的场景中使用，比如短信，微博等，比如 https://www.cnblogs.com/myshowtime/p/16227260.html 转换成短链接为 https://bit.ly/3z0QtB9 设计要求 根据面试的要求，你需要设计一个短链接系统， 链接的长度尽量比较短，每天生成 1 亿个URL，服务要运行 10 年。 首先，我们看一下短链接的工作原理。 工作原理 在 Chrome 上输入短链接，会发生什么？ 打开开发者工具， 可以看到， 服务器收到请求后，会把短链接转换成长链接，然后返回浏览器，进行 301 重定向，请求到长链接地址。 另外一个问题，如何把长链接转换成短链接？ 能否使用一些加密算法呢？明显是行不通的，因为字符串加密后会变的更长。 哈希算法 实际上，我们可以使用哈希算法和哈希表实现，如下 长链接经过哈希算法后， 会生成固定长度的哈希值 key，也就是短链接的值，并保存到哈希表中。 使用短链接查询长链接时，只需要查询哈希表即可。 上面是常见的哈希算法，最少也要8位。 那我们需要多少位的短链接呢？根据上面的要求，一天生成一个亿的短链接，运行10年，1亿 * 365 * 10 = 3650 亿。 短链接的字符在 [0-9,a-z,A-Z] 之间，总共 62 个不同的字符，可以计算出下面的数据。 可以看出，要满足系统要求的话，短链接的长度最少为 7 位。在实际中，很多短链接系统的长度也是 7 位。有兴趣的同学还可以看一下，米勒定律 7±2 法则。 上面的 CRC32 算法，最少也是 8 位。不过我们可以截取前 7 位，最后一位丢弃。但是这样可能会出现哈希冲突的问题，我们可以给长链接递归地拼接一个值，直到不再发现冲突，当然也可以用其他的哈希冲突解决方法。 Base 62 转换 这是另外一种常见的方法，Base 62 字符由大写字母 A-Z、小写字母 a-z 和数字 0-9 组成, 总共 62 位，如下 base 62 和 base 64 相比，只不过少了2个字符 + 和 /，大家可以想一下，这里我们为什么不用 base 64。 Base 62 和上面的哈希算法的思路是不一样的，哈希算法是根据长链接计算哈希值，然后保存到哈希表中。而 base 62 需要给每条长链接生成一个唯一的数字 ID，如下 那么如何计算短链接 ShortURL 呢? 因为 Id 是唯一的 10 进制数字，我们只需要把它转成 62 进制即可， 这里和从2进制转换到10进制是一样的。 假如有一个 ID 为 11157, 转换的过程如下 最终得到的短链接的值为 https://xxx.com/2TX。 总结 在本文中，介绍了两种实现短链接的方法，分别是哈希算法和 base 62。 哈希算法的特点是，固定的短链接长度，不需要生成唯一ID，可能会出现哈希冲突。 base 62 转换的特点是，长度不固定，取决于 ID 的大小，1000 转换后是 G8, 1000 亿 转换后是 1l9Zo9o。另外还需要生成唯一数字 ID，没有哈希冲突的问题。 希望对您有用！ 译：等天黑 作者：Alex Xu 来源：《System Design Interview》 简介: Alex Xu 是一位经验丰富的软件工程师, 曾在 Twitter, Apple 和 Oracle 任职，来自CS名校卡内基梅隆大学，热衷于系统设计。 作者:SpringLeee 原文:https://www.cnblogs.com/myshowtime/p/16316654.html" />
<meta property="og:description" content="短链接系统可以把比较长的 URL 网址转换成简短的网址字符串，短链接的优势是方便传播。适合在一些对字符串长度有要求的场景中使用，比如短信，微博等，比如 https://www.cnblogs.com/myshowtime/p/16227260.html 转换成短链接为 https://bit.ly/3z0QtB9 设计要求 根据面试的要求，你需要设计一个短链接系统， 链接的长度尽量比较短，每天生成 1 亿个URL，服务要运行 10 年。 首先，我们看一下短链接的工作原理。 工作原理 在 Chrome 上输入短链接，会发生什么？ 打开开发者工具， 可以看到， 服务器收到请求后，会把短链接转换成长链接，然后返回浏览器，进行 301 重定向，请求到长链接地址。 另外一个问题，如何把长链接转换成短链接？ 能否使用一些加密算法呢？明显是行不通的，因为字符串加密后会变的更长。 哈希算法 实际上，我们可以使用哈希算法和哈希表实现，如下 长链接经过哈希算法后， 会生成固定长度的哈希值 key，也就是短链接的值，并保存到哈希表中。 使用短链接查询长链接时，只需要查询哈希表即可。 上面是常见的哈希算法，最少也要8位。 那我们需要多少位的短链接呢？根据上面的要求，一天生成一个亿的短链接，运行10年，1亿 * 365 * 10 = 3650 亿。 短链接的字符在 [0-9,a-z,A-Z] 之间，总共 62 个不同的字符，可以计算出下面的数据。 可以看出，要满足系统要求的话，短链接的长度最少为 7 位。在实际中，很多短链接系统的长度也是 7 位。有兴趣的同学还可以看一下，米勒定律 7±2 法则。 上面的 CRC32 算法，最少也是 8 位。不过我们可以截取前 7 位，最后一位丢弃。但是这样可能会出现哈希冲突的问题，我们可以给长链接递归地拼接一个值，直到不再发现冲突，当然也可以用其他的哈希冲突解决方法。 Base 62 转换 这是另外一种常见的方法，Base 62 字符由大写字母 A-Z、小写字母 a-z 和数字 0-9 组成, 总共 62 位，如下 base 62 和 base 64 相比，只不过少了2个字符 + 和 /，大家可以想一下，这里我们为什么不用 base 64。 Base 62 和上面的哈希算法的思路是不一样的，哈希算法是根据长链接计算哈希值，然后保存到哈希表中。而 base 62 需要给每条长链接生成一个唯一的数字 ID，如下 那么如何计算短链接 ShortURL 呢? 因为 Id 是唯一的 10 进制数字，我们只需要把它转成 62 进制即可， 这里和从2进制转换到10进制是一样的。 假如有一个 ID 为 11157, 转换的过程如下 最终得到的短链接的值为 https://xxx.com/2TX。 总结 在本文中，介绍了两种实现短链接的方法，分别是哈希算法和 base 62。 哈希算法的特点是，固定的短链接长度，不需要生成唯一ID，可能会出现哈希冲突。 base 62 转换的特点是，长度不固定，取决于 ID 的大小，1000 转换后是 G8, 1000 亿 转换后是 1l9Zo9o。另外还需要生成唯一数字 ID，没有哈希冲突的问题。 希望对您有用！ 译：等天黑 作者：Alex Xu 来源：《System Design Interview》 简介: Alex Xu 是一位经验丰富的软件工程师, 曾在 Twitter, Apple 和 Oracle 任职，来自CS名校卡内基梅隆大学，热衷于系统设计。 作者:SpringLeee 原文:https://www.cnblogs.com/myshowtime/p/16316654.html" />
<link rel="canonical" href="/cnblog/2022/05/28/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E7%9F%AD%E9%93%BE%E6%8E%A5%E7%B3%BB%E7%BB%9F.html" />
<meta property="og:url" content="/cnblog/2022/05/28/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E7%9F%AD%E9%93%BE%E6%8E%A5%E7%B3%BB%E7%BB%9F.html" />
<meta property="og:site_name" content="dotnet之美" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-28T16:00:22+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="【系统设计】设计一个短链接系统" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-28T16:00:22+00:00","datePublished":"2022-05-28T16:00:22+00:00","description":"短链接系统可以把比较长的 URL 网址转换成简短的网址字符串，短链接的优势是方便传播。适合在一些对字符串长度有要求的场景中使用，比如短信，微博等，比如 https://www.cnblogs.com/myshowtime/p/16227260.html 转换成短链接为 https://bit.ly/3z0QtB9 设计要求 根据面试的要求，你需要设计一个短链接系统， 链接的长度尽量比较短，每天生成 1 亿个URL，服务要运行 10 年。 首先，我们看一下短链接的工作原理。 工作原理 在 Chrome 上输入短链接，会发生什么？ 打开开发者工具， 可以看到， 服务器收到请求后，会把短链接转换成长链接，然后返回浏览器，进行 301 重定向，请求到长链接地址。 另外一个问题，如何把长链接转换成短链接？ 能否使用一些加密算法呢？明显是行不通的，因为字符串加密后会变的更长。 哈希算法 实际上，我们可以使用哈希算法和哈希表实现，如下 长链接经过哈希算法后， 会生成固定长度的哈希值 key，也就是短链接的值，并保存到哈希表中。 使用短链接查询长链接时，只需要查询哈希表即可。 上面是常见的哈希算法，最少也要8位。 那我们需要多少位的短链接呢？根据上面的要求，一天生成一个亿的短链接，运行10年，1亿 * 365 * 10 = 3650 亿。 短链接的字符在 [0-9,a-z,A-Z] 之间，总共 62 个不同的字符，可以计算出下面的数据。 可以看出，要满足系统要求的话，短链接的长度最少为 7 位。在实际中，很多短链接系统的长度也是 7 位。有兴趣的同学还可以看一下，米勒定律 7±2 法则。 上面的 CRC32 算法，最少也是 8 位。不过我们可以截取前 7 位，最后一位丢弃。但是这样可能会出现哈希冲突的问题，我们可以给长链接递归地拼接一个值，直到不再发现冲突，当然也可以用其他的哈希冲突解决方法。 Base 62 转换 这是另外一种常见的方法，Base 62 字符由大写字母 A-Z、小写字母 a-z 和数字 0-9 组成, 总共 62 位，如下 base 62 和 base 64 相比，只不过少了2个字符 + 和 /，大家可以想一下，这里我们为什么不用 base 64。 Base 62 和上面的哈希算法的思路是不一样的，哈希算法是根据长链接计算哈希值，然后保存到哈希表中。而 base 62 需要给每条长链接生成一个唯一的数字 ID，如下 那么如何计算短链接 ShortURL 呢? 因为 Id 是唯一的 10 进制数字，我们只需要把它转成 62 进制即可， 这里和从2进制转换到10进制是一样的。 假如有一个 ID 为 11157, 转换的过程如下 最终得到的短链接的值为 https://xxx.com/2TX。 总结 在本文中，介绍了两种实现短链接的方法，分别是哈希算法和 base 62。 哈希算法的特点是，固定的短链接长度，不需要生成唯一ID，可能会出现哈希冲突。 base 62 转换的特点是，长度不固定，取决于 ID 的大小，1000 转换后是 G8, 1000 亿 转换后是 1l9Zo9o。另外还需要生成唯一数字 ID，没有哈希冲突的问题。 希望对您有用！ 译：等天黑 作者：Alex Xu 来源：《System Design Interview》 简介: Alex Xu 是一位经验丰富的软件工程师, 曾在 Twitter, Apple 和 Oracle 任职，来自CS名校卡内基梅隆大学，热衷于系统设计。 作者:SpringLeee 原文:https://www.cnblogs.com/myshowtime/p/16316654.html","headline":"【系统设计】设计一个短链接系统","mainEntityOfPage":{"@type":"WebPage","@id":"/cnblog/2022/05/28/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E7%9F%AD%E9%93%BE%E6%8E%A5%E7%B3%BB%E7%BB%9F.html"},"url":"/cnblog/2022/05/28/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E7%9F%AD%E9%93%BE%E6%8E%A5%E7%B3%BB%E7%BB%9F.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="dotnet之美" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">dotnet之美</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">【系统设计】设计一个短链接系统</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2022-05-28T16:00:22+00:00" itemprop="datePublished">May 28, 2022
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>短链接系统可以把比较长的 URL 网址转换成简短的网址字符串，短链接的优势是方便传播。适合在一些对字符串长度有要求的场景中使用，比如短信，微博等，比如</p>

<p><a href="https://www.cnblogs.com/myshowtime/p/16227260.html">https://www.cnblogs.com/myshowtime/p/16227260.html</a></p>

<p>转换成短链接为</p>

<p><a href="https://bit.ly/3z0QtB9">https://bit.ly/3z0QtB9</a></p>

<h2 id="设计要求">设计要求</h2>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220510_030844.png" alt="" /></p>

<p>根据面试的要求，你需要设计一个短链接系统， 链接的长度尽量比较短，每天生成 1 亿个URL，服务要运行 10 年。</p>

<p>首先，我们看一下短链接的工作原理。</p>

<h2 id="工作原理">工作原理</h2>

<p>在 Chrome 上输入短链接，会发生什么？</p>

<p>打开开发者工具， 可以看到， 服务器收到请求后，会把短链接转换成长链接，然后返回浏览器，进行 301 重定向，请求到长链接地址。</p>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220518_083323.png" alt="" /></p>

<p>另外一个问题，如何把长链接转换成短链接？</p>

<p>能否使用一些加密算法呢？明显是行不通的，因为字符串加密后会变的更长。</p>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220518_084934.png" alt="" /></p>

<h2 id="哈希算法">哈希算法</h2>

<p>实际上，我们可以使用哈希算法和哈希表实现，如下</p>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220518_092723.png" alt="" /></p>

<p>长链接经过哈希算法后， 会生成固定长度的哈希值 key，也就是短链接的值，并保存到哈希表中。</p>

<p>使用短链接查询长链接时，只需要查询哈希表即可。</p>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220518_094410.png" alt="" /></p>

<p>上面是常见的哈希算法，最少也要8位。</p>

<p>那我们需要多少位的短链接呢？根据上面的要求，一天生成一个亿的短链接，运行10年，1亿 * 365 * 10 = 3650 亿。</p>

<p>短链接的字符在 [0-9,a-z,A-Z] 之间，总共 62 个不同的字符，可以计算出下面的数据。</p>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220518_095739.png" alt="" /></p>

<p>可以看出，要满足系统要求的话，短链接的长度最少为 7 位。在实际中，很多短链接系统的长度也是 7 位。有兴趣的同学还可以看一下，米勒定律 7±2 法则。</p>

<p>上面的 CRC32 算法，最少也是 8 位。不过我们可以截取前 7 位，最后一位丢弃。但是这样可能会出现哈希冲突的问题，我们可以给长链接递归地拼接一个值，直到不再发现冲突，当然也可以用其他的哈希冲突解决方法。</p>

<h2 id="base-62-转换">Base 62 转换</h2>

<p>这是另外一种常见的方法，Base 62 字符由大写字母 A-Z、小写字母 a-z 和数字 0-9 组成,  总共 62 位，如下</p>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220518_102004.png" alt="" /></p>

<p>base 62 和 base 64 相比，只不过少了2个字符 + 和 /，大家可以想一下，这里我们为什么不用 base 64。</p>

<p>Base 62 和上面的哈希算法的思路是不一样的，哈希算法是根据长链接计算哈希值，然后保存到哈希表中。而 base 62 需要给每条长链接生成一个唯一的数字 ID，如下</p>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220518_111319.png" alt="" /></p>

<p>那么如何计算短链接 ShortURL 呢? 因为 Id 是唯一的 10 进制数字，我们只需要把它转成 62 进制即可， 这里和从2进制转换到10进制是一样的。</p>

<p>假如有一个 ID 为 11157,  转换的过程如下</p>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220518_105646.png" alt="" /></p>

<p>最终得到的短链接的值为  <a href="https://xxx.com/2TX%E3%80%82">https://xxx.com/2TX。</a></p>

<p><img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/clipboard_20220518_111631.png" alt="" /></p>

<h2 id="总结">总结</h2>

<p>在本文中，介绍了两种实现短链接的方法，分别是哈希算法和 base 62。</p>

<p>哈希算法的特点是，固定的短链接长度，不需要生成唯一ID，可能会出现哈希冲突。</p>

<p>base 62 转换的特点是，长度不固定，取决于 ID 的大小，1000 转换后是 G8, 1000 亿 转换后是 1l9Zo9o。另外还需要生成唯一数字 ID，没有哈希冲突的问题。</p>

<p>希望对您有用！</p>

<p>译：等天黑</p>

<p>作者：Alex Xu</p>

<p>来源：《System Design Interview》</p>

<p>简介: Alex Xu 是一位经验丰富的软件工程师, 曾在 Twitter, Apple 和 Oracle 任职，来自CS名校卡内基梅隆大学，热衷于系统设计。
 <img src="https://blog-1259586045.cos.ap-shanghai.myqcloud.com/wechat_logo_s1.png" alt="" /></p>
<blockquote>
  <p>作者:SpringLeee<br />
原文:https://www.cnblogs.com/myshowtime/p/16316654.html</p>
</blockquote>

  </div><a class="u-url" href="/cnblog/2022/05/28/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E7%9F%AD%E9%93%BE%E6%8E%A5%E7%B3%BB%E7%BB%9F.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">dotnet之美</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">dotnet之美</li><li><a class="u-email" href="mailto:springhgui@outlook.com">springhgui@outlook.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>分享dotnet技术.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
